modification_time,rule_name,rule_id,description,severity,number_of_alerts,source,rule_type,tactic,technique_id,xql_query,platform
"Nov 20th 2022 12:59:28","[SOC-2835] - AWS - Suspicious Removal of  VPC Flow Logs (TLV-SOC)","118","This activity will detect FlowLogs log that are deleted from any External IPs not related to panw org or GP IPs and a know automation account.","Low","58","cconnack@paloaltonetworks.com","SOC","Defense Evasion","T1562.008","//TLV-SOC dataset = cloud_audit_logs |filter cloud_provider = ENUM.AWS |alter AccessKeyId= json_extract(raw_log,""$.userIdentity.accessKeyId"") |filter caller_ip_asn_org != null and caller_ip != null and caller_ip !~= ""8.47.64.2|199.203.162.213"" |join type = left (dataset = fetch_gw_ips | fields IP ) as IP1 IP1.IP = caller_ip |filter ip not contains caller_ip //excluding GP IP |filter lowercase(caller_ip_asn_org) !~= "".*pan.*|.*palo-alto-networks.*|.*palo-alto.*|.*paloalto.*|.*level3.*"" //Excluding IPs from pan org |filter lowercase(operation_name_orig )~= "".*deleteflowlogs.*"" // This alert will trigger when these operations will be executed on a IAM users intended to be used programmatically not manually by a user. |filter identity_name not contains ""automationuser_anosingh"" and project not contains ""349006084872"" //Excluding this account which does many automations |filter user_agent not contains ""console.ec2.amazonaws.com"" and user_agent not contains ""terraform"" //Excluding activity from the console and terraform |filter identity_name !~= "".*@paloaltonetworks.com"" // Excluding panw activty from a paloalto IAM","AWS" 